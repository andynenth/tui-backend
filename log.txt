2025-07-23 18:33:35 - game.state.round_start - INFO - 📤 Auto-broadcast: phase_change to room D9D854 - Round 2 starting with Andy
🔍 BOT_MANAGER: Returning existing singleton instance with 1 active games
2025-07-23 18:33:35 - engine.state_machine.game_state_machine - INFO - Stored phase change event: GamePhase.PREPARATION -> GamePhase.ROUND_START
🔍 STATE_MACHINE: BotManager imported successfully
🔍 BOT_MANAGER: Returning existing singleton instance with 1 active games
🔍 STATE_MACHINE: BotManager instance created
2025-07-23 18:33:35 - engine.state_machine.game_state_machine - INFO - Notifying bot manager about phase round_start
🔍 STATE_MACHINE: Notifying bot manager about phase round_start for room D9D854
🔍 BOT_MANAGER: Received event 'phase_change' for room D9D854
🔍 BOT_MANAGER: Current active games: ['D9D854']
🔍 BOT_HANDLER: Processing event 'phase_change' for room D9D854
🔍 BOT_HANDLER: Phase change detected - new phase: round_start, last phase: turn
🔍 BOT_HANDLER: Handling phase_change event
🔍 BOT_HANDLER: _handle_enterprise_phase_change - phase: round_start, phase_data keys: ['round_number', 'current_starter', 'starter_reason', 'display_duration']
2025-07-23 18:33:39 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 40: Checking 1 rooms: ['D9D854']
2025-07-23 18:33:39 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:33:40 - engine.state_machine.game_state_machine - INFO - Transitioning from GamePhase.ROUND_START to GamePhase.DECLARATION
2025-07-23 18:33:40 - engine.state_machine.game_state_machine - INFO - 🔄 Transitioning: GamePhase.ROUND_START -> GamePhase.DECLARATION
2025-07-23 18:33:40 - game.state.round_start - INFO - Exiting round_start phase
2025-07-23 18:33:40 - game.state.round_start - INFO - 🎯 Round start display complete - transitioning to Declaration
2025-07-23 18:33:40 - game.state.declaration - INFO - Entering declaration phase
2025-07-23 18:33:40 - game.state.declaration - INFO - 🎮 Phase Data Update: Declaration phase setup - basic data
2025-07-23 18:33:40 - game.state.declaration - INFO - 📤 Auto-broadcast: phase_change to room D9D854 - Declaration phase setup - basic data
🔍 BOT_MANAGER: Returning existing singleton instance with 1 active games
2025-07-23 18:33:40 - game.state.declaration - INFO - 🎮 Phase Data Update: Declaration phase setup complete - current declarer: Andy
2025-07-23 18:33:40 - game.state.declaration - INFO - 📤 Auto-broadcast: phase_change to room D9D854 - Declaration phase setup complete - current declarer: Andy
🔍 BOT_MANAGER: Returning existing singleton instance with 1 active games
🔍 BOT_MANAGER: Received event 'phase_change' for room D9D854
🔍 BOT_MANAGER: Current active games: ['D9D854']
🔍 BOT_HANDLER: Processing event 'phase_change' for room D9D854
🔍 BOT_HANDLER: Phase change detected - new phase: declaration, last phase: round_start
🔍 BOT_HANDLER: Handling phase_change event
🔍 BOT_HANDLER: _handle_enterprise_phase_change - phase: declaration, phase_data keys: ['declaration_order', 'current_declarer_index', 'declarations', 'declaration_total', 'current_declarer']
🔍 BOT_HANDLER: Processing declaration phase
🔍 BOT_HANDLER: Current declarer: Andy
2025-07-23 18:33:40 - engine.state_machine.game_state_machine - INFO - Stored phase change event: GamePhase.ROUND_START -> GamePhase.DECLARATION
🔍 STATE_MACHINE: BotManager imported successfully
🔍 BOT_MANAGER: Returning existing singleton instance with 1 active games
🔍 STATE_MACHINE: BotManager instance created
2025-07-23 18:33:40 - engine.state_machine.game_state_machine - INFO - Notifying bot manager about phase declaration
🔍 STATE_MACHINE: Notifying bot manager about phase declaration for room D9D854
🔍 BOT_MANAGER: Received event 'round_started' for room D9D854
🔍 BOT_MANAGER: Current active games: ['D9D854']
🔍 BOT_HANDLER: Processing event 'round_started' for room D9D854
🔍 BOT_HANDLER: Handling round_started event, data: {'phase': 'declaration', 'starter': 'Andy'}
🔍 BOT_HANDLER: Calling _handle_round_start
🔍 BOT_HANDLER: _handle_round_start called
🔍 BOT_HANDLER: Game state type: <class 'engine.state_machine.async_game_adapter.AsyncGameAdapter'>
🔍 BOT_HANDLER: round_starter attribute: Andy
🔍 BOT_HANDLER: Starter object found: Andy - -2 pts, is_bot: False
👤 Round starter is human or None: Andy
🔍 BOT_HANDLER: _handle_declaration_phase called with last_declarer: ''
🔍 BOT_HANDLER: Declaration order: ['Andy', 'Bot 2', 'P2', 'Bot 4']
🔍 BOT_HANDLER: Last declarer index: -1
2025-07-23 18:33:44 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 41: Checking 1 rooms: ['D9D854']
2025-07-23 18:33:44 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:33:49 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 42: Checking 1 rooms: ['D9D854']
2025-07-23 18:33:49 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
INFO:     127.0.0.1:60801 - "GET /game/D9D854 HTTP/1.1" 404 Not Found
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] Handling disconnect for room 'lobby', websocket_id: b77c3426-49ea-4874-9ffd-24834fd4c84f at 1753320832.368116
2025-07-23 18:33:52 - api.websocket.connection_manager - WARNING - WebSocket ID b77c3426-49ea-4874-9ffd-24834fd4c84f not found in mapping. Current mappings: ['f516bf63-b616-4618-8508-815b9b1a6a7a', '235ebb3d-6502-4185-8fbd-b077283e2f13']
2025-07-23 18:33:52 - backend.api.routes.ws - WARNING - No websocket_id found on websocket object for room lobby
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - ⚠️ [ROOM_DEBUG] WebSocket disconnect without ID for room 'lobby'
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] WebSocket unregistered from room 'lobby'
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] Handling disconnect for room 'D9D854', websocket_id: f516bf63-b616-4618-8508-815b9b1a6a7a at 1753320832.36945
2025-07-23 18:33:52 - api.websocket.connection_manager - INFO - Player Andy disconnected from room D9D854. Can reconnect anytime while game is active.
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - 🎮 [ROOM_DEBUG] In-game disconnect detected for player 'Andy' in room 'D9D854'
2025-07-23 18:33:52 - api.websocket.message_queue - INFO - Created message queue for Andy in room D9D854
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - Player Andy disconnected from game in room D9D854. Bot activated.
2025-07-23 18:33:52 - engine.async_room - INFO - Host migrated from Andy to P2 in room D9D854
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - Host migrated to P2 in room D9D854
INFO:     connection closed
2025-07-23 18:33:52 - engine.async_room - INFO - 👥 [ROOM_DEBUG] Room 'D9D854' player count: 1 humans, 3 bots
2025-07-23 18:33:52 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] WebSocket unregistered from room 'D9D854'
INFO:     connection closed
INFO:     127.0.0.1:60801 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-07-23 18:33:54 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 43: Checking 1 rooms: ['D9D854']
2025-07-23 18:33:54 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
INFO:     127.0.0.1:60821 - "GET /game/D9D854 HTTP/1.1" 404 Not Found
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] Handling disconnect for room 'D9D854', websocket_id: 235ebb3d-6502-4185-8fbd-b077283e2f13 at 1753320835.9442718
2025-07-23 18:33:55 - api.websocket.connection_manager - INFO - Player P2 disconnected from room D9D854. Can reconnect anytime while game is active.
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - 🎮 [ROOM_DEBUG] In-game disconnect detected for player 'P2' in room 'D9D854'
2025-07-23 18:33:55 - api.websocket.message_queue - INFO - Created message queue for P2 in room D9D854
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - Player P2 disconnected from game in room D9D854. Bot activated.
2025-07-23 18:33:55 - engine.async_room - INFO - Host migrated from P2 to bot Andy in room D9D854
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - Host migrated to Andy in room D9D854
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] Handling disconnect for room 'lobby', websocket_id: 868055b8-f6d0-4c01-bf2b-7c22b63afb61 at 1753320835.945761
2025-07-23 18:33:55 - api.websocket.connection_manager - WARNING - WebSocket ID 868055b8-f6d0-4c01-bf2b-7c22b63afb61 not found in mapping. Current mappings: []
2025-07-23 18:33:55 - backend.api.routes.ws - WARNING - No websocket_id found on websocket object for room lobby
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - ⚠️ [ROOM_DEBUG] WebSocket disconnect without ID for room 'lobby'
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] WebSocket unregistered from room 'lobby'
INFO:     connection closed
2025-07-23 18:33:55 - engine.async_room_manager - WARNING - Room lobby not found in AsyncRoomManager. Current rooms: ['D9D854']
2025-07-23 18:33:55 - engine.async_room - INFO - 👥 [ROOM_DEBUG] Room 'D9D854' player count: 0 humans, 4 bots
2025-07-23 18:33:55 - engine.async_room - INFO - 👥 [ROOM_DEBUG] Room 'D9D854' player count: 0 humans, 4 bots
2025-07-23 18:33:55 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:33:55 - engine.async_room - INFO - 🗑️ [ROOM_DEBUG] Room 'D9D854' marked for cleanup at 1753320835.947583, timeout=30s
2025-07-23 18:33:55 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - All players in room D9D854 are now bots. Cleanup scheduled in 30s
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - 🤖 [ROOM_DEBUG] Room 'D9D854' has no human players, marked for cleanup
2025-07-23 18:33:55 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] WebSocket unregistered from room 'D9D854'
INFO:     connection closed
INFO:     127.0.0.1:60821 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-07-23 18:33:59 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 44: Checking 1 rooms: ['D9D854']
2025-07-23 18:33:59 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:33:59 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:04 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 45: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:04 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:04 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:09 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 46: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:09 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:09 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:14 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 47: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:14 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:14 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
INFO:     127.0.0.1:60823 - "GET / HTTP/1.1" 304 Not Modified
2025-07-23 18:34:19 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 48: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:19 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:19 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
INFO:     127.0.0.1:60823 - "GET /bundle.css HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:60919 - "GET /bundle.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:60917 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:60917 - "GET /bundle.js.map HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:60917 - "GET /bundle.css.map HTTP/1.1" 304 Not Modified
2025-07-23 18:34:19 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] New WebSocket connection to room 'D9D854', ws_id: 1514567f-8260-43ba-8ab0-687a58c5287d at 1753320859.736178
2025-07-23 18:34:19 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Room cleanup task already running
INFO:     ('127.0.0.1', 60921) - "WebSocket /ws/D9D854" [accepted]
INFO:     connection open
2025-07-23 18:34:19 - api.websocket.connection_manager - INFO - Player P2 reconnected to room D9D854
2025-07-23 18:34:19 - backend.api.routes.ws - INFO - Successfully registered player P2 for room D9D854
2025-07-23 18:34:19 - backend.api.routes.ws - INFO - 🔌 RECONNECT_CHECK: Room D9D854 - started=True, game_ended=False
2025-07-23 18:34:19 - engine.async_room - INFO - ✅ [ROOM_DEBUG] Cleanup cancelled for room 'D9D854' - human player reconnected
2025-07-23 18:34:19 - backend.api.routes.ws - INFO - Player P2 reconnected to game in room D9D854
2025-07-23 18:34:19 - api.websocket.message_queue - INFO - Retrieved 0 queued messages for P2
2025-07-23 18:34:19 - api.websocket.message_queue - INFO - Cleared message queue for P2 in room D9D854
2025-07-23 18:34:24 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 49: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:24 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:29 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 50: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:29 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:34 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 51: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:34 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:39 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 52: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:39 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 53: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
INFO:     127.0.0.1:61023 - "GET /game/D9D854 HTTP/1.1" 404 Not Found
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] Handling disconnect for room 'D9D854', websocket_id: 1514567f-8260-43ba-8ab0-687a58c5287d at 1753320884.492641
2025-07-23 18:34:44 - api.websocket.connection_manager - INFO - Player P2 disconnected from room D9D854. Can reconnect anytime while game is active.
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - 🎮 [ROOM_DEBUG] In-game disconnect detected for player 'P2' in room 'D9D854'
2025-07-23 18:34:44 - api.websocket.message_queue - INFO - Created message queue for P2 in room D9D854
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - Player P2 disconnected from game in room D9D854. Bot activated.
2025-07-23 18:34:44 - engine.async_room - INFO - 👥 [ROOM_DEBUG] Room 'D9D854' player count: 0 humans, 4 bots
2025-07-23 18:34:44 - engine.async_room - INFO - 👥 [ROOM_DEBUG] Room 'D9D854' player count: 0 humans, 4 bots
2025-07-23 18:34:44 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:44 - engine.async_room - INFO - 🗑️ [ROOM_DEBUG] Room 'D9D854' marked for cleanup at 1753320884.509391, timeout=30s
2025-07-23 18:34:44 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - All players in room D9D854 are now bots. Cleanup scheduled in 30s
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - 🤖 [ROOM_DEBUG] Room 'D9D854' has no human players, marked for cleanup
2025-07-23 18:34:44 - backend.api.routes.ws - INFO - 🔌 [ROOM_DEBUG] WebSocket unregistered from room 'D9D854'
INFO:     connection closed
INFO:     127.0.0.1:61023 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-07-23 18:34:49 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 54: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:49 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:49 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
2025-07-23 18:34:54 - backend.api.routes.ws - INFO - 🧹 [ROOM_DEBUG] Cleanup iteration 55: Checking 1 rooms: ['D9D854']
2025-07-23 18:34:54 - engine.async_room - INFO - ⏱️ [ROOM_DEBUG] Room 'D9D854' using cleanup timeout: 30s (started=True, game_ended=False)
2025-07-23 18:34:54 - backend.api.routes.ws - INFO - 🧹 CLEANUP_CHECK: Room D9D854 - game_ended=False, should_cleanup=False
