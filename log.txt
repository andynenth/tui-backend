🔒 [Room E146C2] Starting game: op_id=E146C2_1
🔍 DEBUG: Redeal limit check - multiplier: 1, limit: 2
🔧 DEBUG: Dealing weak hands to players at indices [0] (max 9 points)
📊 DEBUG: Redeals so far: 0, Max allowed: 2
🔧 DEBUG: Found 24 weak pieces (≤9), 8 strong pieces (>9)
🔧 DEBUG: Andy (index 0) assigned weak hand
🔧 DEBUG: Final hands verification:
  Andy: ['SOLDIER_BLACK(1)', 'SOLDIER_RED(2)', 'SOLDIER_RED(2)', 'SOLDIER_BLACK(1)', 'SOLDIER_BLACK(1)', 'CHARIOT_BLACK(7)', 'SOLDIER_RED(2)', 'HORSE_RED(6)']
    → Strong pieces (>9): 0
    → Has RED_GENERAL: False
    ⚠️ WARNING: Andy has NO strong pieces!
  Bot 2: ['ADVISOR_BLACK(11)', 'GENERAL_RED(14)', 'CHARIOT_RED(8)', 'ADVISOR_RED(12)', 'ADVISOR_BLACK(11)', 'SOLDIER_BLACK(1)', 'SOLDIER_RED(2)', 'ELEPHANT_RED(10)']
    → Strong pieces (>9): 5
    → Has RED_GENERAL: True
  Bot 3: ['ELEPHANT_RED(10)', 'CANNON_RED(4)', 'CHARIOT_BLACK(7)', 'CANNON_RED(4)', 'ELEPHANT_BLACK(9)', 'SOLDIER_RED(2)', 'GENERAL_BLACK(13)', 'CHARIOT_RED(8)']
    → Strong pieces (>9): 2
    → Has RED_GENERAL: False
  Bot 4: ['ELEPHANT_BLACK(9)', 'CANNON_BLACK(3)', 'HORSE_RED(6)', 'HORSE_BLACK(5)', 'CANNON_BLACK(3)', 'SOLDIER_BLACK(1)', 'HORSE_BLACK(5)', 'ADVISOR_RED(12)']
    → Strong pieces (>9): 1
    → Has RED_GENERAL: False
🔍 PREP_STATE_DEBUG: Play order: [Andy - 0 pts, Bot 2 - 0 pts, Bot 3 - 0 pts, Bot 4 - 0 pts]
🔍 PREP_STATE_DEBUG: Play order types: [<class 'engine.player.Player'>, <class 'engine.player.Player'>, <class 'engine.player.Player'>, <class 'engine.player.Player'>]
🔍 PREP_STATE_DEBUG: Checking player Andy against weak players {'Andy'}
✅ PREP_STATE_DEBUG: Added Andy to pending weak players
🔍 PREP_STATE_DEBUG: Checking player Bot 2 against weak players {'Andy'}
❌ PREP_STATE_DEBUG: Bot 2 not in weak players
🔍 PREP_STATE_DEBUG: Checking player Bot 3 against weak players {'Andy'}
❌ PREP_STATE_DEBUG: Bot 3 not in weak players
🔍 PREP_STATE_DEBUG: Checking player Bot 4 against weak players {'Andy'}
❌ PREP_STATE_DEBUG: Bot 4 not in weak players
🎯 PREP_STATE_DEBUG: Current weak player to ask: Andy
📋 PREP_STATE_DEBUG: Pending weak players queue: ['Andy']
🤖 PREP_STATE_DEBUG: Triggering bot manager for redeal decisions...
🔧 PREP_STATE_DEBUG: Triggering bot manager for player: Andy
🔧 PREP_STATE_DEBUG: Using room_id: E146C2
🔧 PREP_STATE_DEBUG: Bot manager active games: ['E146C2']
🔄 BOT_HANDLER_DEBUG: Handling redeal decision needed
DEBUG_WS: Message for event 'phase_change' added to queue for room E146C2.
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
✅ [Room E146C2] Game and StateMachine started successfully: op_id=E146C2_1
✅ [Room E146C2] Bot manager registered for 3 bots
✅ Game started in room E146C2
DEBUG_WS_DISCONNECT: WebSocket client disconnected from room E146C2.
INFO:     connection closed
DEBUG_WS: Unregistered connection for room E146C2. Remaining connections: 0
DEBUG_WS: Room E146C2 has active game - keeping broadcast queue alive
INFO:     ('127.0.0.1', 56878) - "WebSocket /ws/E146C2" [accepted]
DEBUG_WS: Registered new connection for room E146C2. Total connections: 1
INFO:     connection open
DEBUG_WS_RECEIVE: Received event 'client_ready' from client in room E146C2 with data: {'room_id': 'E146C2'}
DEBUG_WS_RECEIVE: Sent current game phase preparation to client in room E146C2
DEBUG_WS_RECEIVE: Sent initial room state to client in room E146C2 after client_ready.
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy
⏳ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/1)
🔍 PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Andy'}
   - Redeal decisions: {}
   - Current weak player: Andy