ğŸ”’ [Room AC30F8] Starting game: op_id=AC30F8_1
ğŸ” DEBUG: Redeal limit check - multiplier: 1, limit: 2
ğŸ”§ DEBUG: Dealing weak hands to players at indices [0, 1] (max 9 points)
ğŸ“Š DEBUG: Redeals so far: 0, Max allowed: 2
ğŸ”§ DEBUG: Found 24 weak pieces (â‰¤9), 8 strong pieces (>9)
ğŸ”§ DEBUG: Andy (index 0) assigned weak hand
ğŸ”§ DEBUG: Bot 2 (index 1) assigned weak hand
ğŸ”§ DEBUG: Final hands verification:
  Andy: ['SOLDIER_BLACK(1)', 'CANNON_BLACK(3)', 'HORSE_BLACK(5)', 'SOLDIER_RED(2)', 'CHARIOT_RED(8)', 'SOLDIER_BLACK(1)', 'CHARIOT_BLACK(7)', 'ELEPHANT_BLACK(9)']
    â†’ Strong pieces (>9): 0
    â†’ Has RED_GENERAL: False
    âš ï¸ WARNING: Andy has NO strong pieces!
  Bot 2: ['HORSE_RED(6)', 'HORSE_BLACK(5)', 'SOLDIER_BLACK(1)', 'SOLDIER_RED(2)', 'ELEPHANT_BLACK(9)', 'CANNON_RED(4)', 'SOLDIER_RED(2)', 'CANNON_BLACK(3)']
    â†’ Strong pieces (>9): 0
    â†’ Has RED_GENERAL: False
    âš ï¸ WARNING: Bot 2 has NO strong pieces!
  Bot 3: ['CHARIOT_BLACK(7)', 'SOLDIER_BLACK(1)', 'ELEPHANT_RED(10)', 'ADVISOR_RED(12)', 'SOLDIER_RED(2)', 'ADVISOR_BLACK(11)', 'GENERAL_RED(14)', 'GENERAL_BLACK(13)']
    â†’ Strong pieces (>9): 5
    â†’ Has RED_GENERAL: True
  Bot 4: ['ELEPHANT_RED(10)', 'HORSE_RED(6)', 'CHARIOT_RED(8)', 'SOLDIER_RED(2)', 'SOLDIER_BLACK(1)', 'CANNON_RED(4)', 'ADVISOR_RED(12)', 'ADVISOR_BLACK(11)']
    â†’ Strong pieces (>9): 3
    â†’ Has RED_GENERAL: False
ğŸ” PREP_STATE_DEBUG: Play order: [Andy - 0 pts, Bot 2 - 0 pts, Bot 3 - 0 pts, Bot 4 - 0 pts]
ğŸ” PREP_STATE_DEBUG: Play order types: [<class 'engine.player.Player'>, <class 'engine.player.Player'>, <class 'engine.player.Player'>, <class 'engine.player.Player'>]
ğŸ¯ PREP_STATE_DEBUG: All weak players awaiting simultaneous decisions: {'Bot 2', 'Andy'}
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ¤– PREP_STATE_DEBUG: Triggering bot manager for simultaneous redeal decisions...
ğŸ¤– PREP_STATE_DEBUG: Bot weak player found: Bot 2
ğŸ‘¤ PREP_STATE_DEBUG: Human weak player: Andy - waiting for UI
ğŸ”„ BOT_HANDLER_DEBUG: Handling simultaneous redeal decisions
ğŸ¤– SIMULTANEOUS_REDEAL: Handling 1 bot decisions: ['Bot 2']
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
âœ… [Room AC30F8] Game and StateMachine started successfully: op_id=AC30F8_1
âœ… [Room AC30F8] Bot manager registered for 3 bots
âœ… Game started in room AC30F8
DEBUG_WS_DISCONNECT: WebSocket client disconnected from room AC30F8.
INFO:     connection closed
DEBUG_WS: Unregistered connection for room AC30F8. Remaining connections: 0
DEBUG_WS: Room AC30F8 has active game - keeping broadcast queue alive
INFO:     ('127.0.0.1', 57450) - "WebSocket /ws/AC30F8" [accepted]
DEBUG_WS: Registered new connection for room AC30F8. Total connections: 1
INFO:     connection open
DEBUG_WS_RECEIVE: Received event 'client_ready' from client in room AC30F8 with data: {'room_id': 'AC30F8'}
DEBUG_WS_RECEIVE: Sent current game phase preparation to client in room AC30F8
DEBUG_WS_RECEIVE: Sent initial room state to client in room AC30F8 after client_ready.
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ¤– Bot Bot 2 deciding after 1.6s delay: ACCEPT
âœ… Bot Bot 2 ACCEPTED redeal
ğŸ” REDEAL_DEBUG: Processing REDEAL_REQUEST as accept for Bot 2
ğŸ” REDEAL_DEBUG: _handle_redeal_decision - Bot 2 decision: accept=True
ğŸ” REDEAL_DEBUG: Recorded decision - redeal_decisions now: {'Bot 2': True}
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {'Bot 2': True}
   - Weak players awaiting: {'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (1/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {'Bot 2': True}
   - Weak players awaiting: {'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (1/2)
DEBUG_WS_RECEIVE: Received event 'decline_redeal' from client in room AC30F8 with data: {'player_name': 'Andy'}
âœ… Redeal decline queued: Andy
ğŸ” REDEAL_DEBUG: Processing REDEAL_RESPONSE for Andy, accept=False
ğŸ” REDEAL_DEBUG: _handle_redeal_decision - Andy decision: accept=False
ğŸ” REDEAL_DEBUG: Recorded decision - redeal_decisions now: {'Bot 2': True, 'Andy': False}
ğŸ” REDEAL_DEBUG: _process_all_decisions - first_accepter: Bot 2, all decisions: {'Bot 2': True, 'Andy': False}
ğŸ” DEBUG: Redeal limit check - multiplier: 2, limit: 2
ğŸ”§ DEBUG: Dealing weak hands to players at indices [0, 1] (max 9 points)
ğŸ“Š DEBUG: Redeals so far: 1, Max allowed: 2
ğŸ”§ DEBUG: Found 24 weak pieces (â‰¤9), 8 strong pieces (>9)
ğŸ”§ DEBUG: Andy (index 0) assigned weak hand
ğŸ”§ DEBUG: Bot 2 (index 1) assigned weak hand
ğŸ”§ DEBUG: Final hands verification:
  Andy: ['SOLDIER_RED(2)', 'SOLDIER_RED(2)', 'CHARIOT_RED(8)', 'SOLDIER_BLACK(1)', 'SOLDIER_BLACK(1)', 'CHARIOT_BLACK(7)', 'HORSE_RED(6)', 'SOLDIER_BLACK(1)']
    â†’ Strong pieces (>9): 0
    â†’ Has RED_GENERAL: False
    âš ï¸ WARNING: Andy has NO strong pieces!
  Bot 2: ['CANNON_RED(4)', 'SOLDIER_BLACK(1)', 'SOLDIER_BLACK(1)', 'ELEPHANT_BLACK(9)', 'SOLDIER_RED(2)', 'CHARIOT_RED(8)', 'CANNON_BLACK(3)', 'SOLDIER_RED(2)']
    â†’ Strong pieces (>9): 0
    â†’ Has RED_GENERAL: False
    âš ï¸ WARNING: Bot 2 has NO strong pieces!
  Bot 3: ['CHARIOT_BLACK(7)', 'ADVISOR_RED(12)', 'ADVISOR_RED(12)', 'GENERAL_BLACK(13)', 'HORSE_BLACK(5)', 'CANNON_RED(4)', 'CANNON_BLACK(3)', 'HORSE_BLACK(5)']
    â†’ Strong pieces (>9): 3
    â†’ Has RED_GENERAL: False
  Bot 4: ['ADVISOR_BLACK(11)', 'GENERAL_RED(14)', 'ELEPHANT_RED(10)', 'HORSE_RED(6)', 'SOLDIER_RED(2)', 'ADVISOR_BLACK(11)', 'ELEPHANT_BLACK(9)', 'ELEPHANT_RED(10)']
    â†’ Strong pieces (>9): 5
    â†’ Has RED_GENERAL: True
ğŸ” PREP_STATE_DEBUG: Play order: [Bot 2 - 0 pts, Bot 3 - 0 pts, Bot 4 - 0 pts, Andy - 0 pts]
ğŸ” PREP_STATE_DEBUG: Play order types: [<class 'engine.player.Player'>, <class 'engine.player.Player'>, <class 'engine.player.Player'>, <class 'engine.player.Player'>]
ğŸ¯ PREP_STATE_DEBUG: All weak players awaiting simultaneous decisions: {'Bot 2', 'Andy'}
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ¤– PREP_STATE_DEBUG: Triggering bot manager for simultaneous redeal decisions...
ğŸ¤– PREP_STATE_DEBUG: Bot weak player found: Bot 2
ğŸ‘¤ PREP_STATE_DEBUG: Human weak player: Andy - waiting for UI
ğŸ”„ BOT_HANDLER_DEBUG: Handling simultaneous redeal decisions
ğŸ¤– SIMULTANEOUS_REDEAL: Handling 1 bot decisions: ['Bot 2']
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {}
   - Weak players awaiting: {'Bot 2', 'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (0/2)
ğŸ¤– Bot Bot 2 deciding after 2.8s delay: ACCEPT
âœ… Bot Bot 2 ACCEPTED redeal
ğŸ” REDEAL_DEBUG: Processing REDEAL_REQUEST as accept for Bot 2
ğŸ” REDEAL_DEBUG: _handle_redeal_decision - Bot 2 decision: accept=True
ğŸ” REDEAL_DEBUG: Recorded decision - redeal_decisions now: {'Bot 2': True}
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {'Bot 2': True}
   - Weak players awaiting: {'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (1/2)
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: {'Bot 2', 'Andy'}
   - Redeal decisions: {'Bot 2': True}
   - Weak players awaiting: {'Andy'}
   - All decisions received: False
â³ PREP_STATE_DEBUG: Waiting for more redeal decisions (1/2)
DEBUG_WS_RECEIVE: Received event 'accept_redeal' from client in room AC30F8 with data: {'player_name': 'Andy'}
âœ… Redeal accept queued: Andy
ğŸ” REDEAL_DEBUG: Processing REDEAL_RESPONSE for Andy, accept=True
ğŸ” REDEAL_DEBUG: _handle_redeal_decision - Andy decision: accept=True
ğŸ” REDEAL_DEBUG: Recorded decision - redeal_decisions now: {'Bot 2': True, 'Andy': True}
ğŸ” REDEAL_DEBUG: _process_all_decisions - first_accepter: Bot 2, all decisions: {'Bot 2': True, 'Andy': True}
ğŸ” DEBUG: Redeal limit check - multiplier: 3, limit: 2
ğŸš« DEBUG: Redeal limit (2) exceeded. Multiplier is 3 (>3)
ğŸ”„ DEBUG: Switching to guaranteed no redeal to prevent infinite loop.
ğŸ›¡ï¸ DEBUG: Dealing guaranteed no-redeal hands
ğŸ›¡ï¸ DEBUG: Available pieces - Strong: 7, Weak: 24
  â†’ Andy gets strong piece: ADVISOR_BLACK(11)
  â†’ Bot 2 gets strong piece: ELEPHANT_RED(10)
  â†’ Bot 3 gets strong piece: GENERAL_BLACK(13)
  â†’ Bot 4 gets strong piece: ADVISOR_RED(12)
ğŸ›¡ï¸ DEBUG: Guaranteed no-redeal hands dealt:
ğŸ”§ DEBUG: Final hands verification:
  Andy: ['SOLDIER_BLACK(1)', 'SOLDIER_RED(2)', 'SOLDIER_BLACK(1)', 'CHARIOT_BLACK(7)', 'SOLDIER_RED(2)', 'ADVISOR_BLACK(11)', 'HORSE_BLACK(5)', 'ELEPHANT_BLACK(9)']
    â†’ Strong pieces (>9): 1
    â†’ Has RED_GENERAL: False
  Bot 2: ['HORSE_BLACK(5)', 'ELEPHANT_RED(10)', 'CANNON_RED(4)', 'SOLDIER_RED(2)', 'CHARIOT_RED(8)', 'ADVISOR_BLACK(11)', 'SOLDIER_RED(2)', 'CANNON_BLACK(3)']
    â†’ Strong pieces (>9): 2
    â†’ Has RED_GENERAL: False
  Bot 3: ['CHARIOT_BLACK(7)', 'HORSE_RED(6)', 'HORSE_RED(6)', 'SOLDIER_RED(2)', 'ADVISOR_RED(12)', 'CHARIOT_RED(8)', 'GENERAL_BLACK(13)', 'CANNON_RED(4)']
    â†’ Strong pieces (>9): 2
    â†’ Has RED_GENERAL: False
  Bot 4: ['GENERAL_RED(14)', 'SOLDIER_BLACK(1)', 'ELEPHANT_RED(10)', 'ELEPHANT_BLACK(9)', 'SOLDIER_BLACK(1)', 'ADVISOR_RED(12)', 'SOLDIER_BLACK(1)', 'CANNON_BLACK(3)']
    â†’ Strong pieces (>9): 3
    â†’ Has RED_GENERAL: True
âœ… SUCCESS: No weak hands - redeal prevented!
âœ… PREP_STATE_DEBUG: No weak hands - keeping existing starter: Bot 2
ğŸ” PREP_STATE_DEBUG: Checking transition conditions...
   - Initial deal complete: True
   - Weak players: set()
   - Redeal decisions: {}
   - Weak players awaiting: set()
   - All decisions received: True
âœ… PREP_STATE_DEBUG: No weak players, transitioning to DECLARATION
ğŸ“¢ DECL_STATE_DEBUG: Using round_starter: Bot 2
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ”„ PHASE_TRACKING_FIX: New phase detected None -> declaration
âœ… PHASE_TRACKING_FIX: Marked declaration phase as triggered
ğŸ” DECL_PHASE_DEBUG: _handle_declaration_phase called with last_declarer: ''
ğŸ” BOT_DEBUG: Got declaration order from state machine: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ” DECL_PHASE_DEBUG: Declaration order: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ” DECL_PHASE_DEBUG: Last declarer '' index: -1
ğŸ” DECL_PHASE_DEBUG: Starting loop from index 0 to 4
ğŸ” DECL_PHASE_DEBUG: Checking player 0 (Bot 2), is_bot: True
ğŸ” DECL_PHASE_DEBUG: Player Bot 2 declared value: 0 (from phase data)
ğŸ” DECL_PHASE_DEBUG: All phase declarations: {}
ğŸ¤– DECL_PHASE_DEBUG: Bot Bot 2 will now declare!
ğŸ”§ BOT_DECLARE_DEBUG: State machine result: {'success': True, 'queued': True}
âœ… Bot Bot 2 declared 1
ğŸ” DECL_PHASE_DEBUG: Checking player 1 (Bot 3), is_bot: True
ğŸ” DECL_PHASE_DEBUG: Player Bot 3 declared value: 0 (from phase data)
ğŸ” DECL_PHASE_DEBUG: All phase declarations: {}
ğŸ¤– DECL_PHASE_DEBUG: Bot Bot 3 will now declare!
ğŸ”§ BOT_DECLARE_DEBUG: State machine result: {'success': True, 'queued': True}
âœ… Bot Bot 3 declared 4
ğŸ” DECL_PHASE_DEBUG: Checking player 2 (Bot 4), is_bot: True
ğŸ” DECL_PHASE_DEBUG: Player Bot 4 declared value: 0 (from phase data)
ğŸ” DECL_PHASE_DEBUG: All phase declarations: {}
ğŸ¤– DECL_PHASE_DEBUG: Bot Bot 4 will now declare!
ğŸ”§ BOT_DECLARE_DEBUG: State machine result: {'success': True, 'queued': True}
âœ… Bot Bot 4 declared 3
ğŸ” DECL_PHASE_DEBUG: Checking player 3 (Andy), is_bot: False
ğŸ” DECL_PHASE_DEBUG: Player Andy is human, stopping bot declarations
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸš« PHASE_TRACKING_FIX: Already triggered actions for declaration phase via round_started - skipping
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PHASE_TRACKING_FIX: Same phase update: declaration
âœ… PHASE_TRACKING_FIX: Marked declaration phase as triggered
ğŸ” DECL_PHASE_DEBUG: _handle_declaration_phase called with last_declarer: 'Bot 2'
ğŸ” BOT_DEBUG: Got declaration order from state machine: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ” DECL_PHASE_DEBUG: Declaration order: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ” DECL_PHASE_DEBUG: Last declarer 'Bot 2' index: 0
ğŸ” DECL_PHASE_DEBUG: Starting loop from index 1 to 4
ğŸ” DECL_PHASE_DEBUG: Checking player 1 (Bot 3), is_bot: True
ğŸ” DECL_PHASE_DEBUG: Player Bot 3 declared value: 0 (from phase data)
ğŸ” DECL_PHASE_DEBUG: All phase declarations: {'Bot 2': 1}
ğŸ¤– DECL_PHASE_DEBUG: Bot Bot 3 will now declare!
ğŸ”§ BOT_DECLARE_DEBUG: State machine result: {'success': True, 'queued': True}
âœ… Bot Bot 3 declared 4
ğŸ” DECL_PHASE_DEBUG: Checking player 2 (Bot 4), is_bot: True
ğŸ” DECL_PHASE_DEBUG: Player Bot 4 declared value: 0 (from phase data)
ğŸ” DECL_PHASE_DEBUG: All phase declarations: {'Bot 2': 1}
ğŸ¤– DECL_PHASE_DEBUG: Bot Bot 4 will now declare!
ğŸ”§ BOT_DECLARE_DEBUG: State machine result: {'success': True, 'queued': True}
âœ… Bot Bot 4 declared 3
ğŸ” DECL_PHASE_DEBUG: Checking player 3 (Andy), is_bot: False
ğŸ” DECL_PHASE_DEBUG: Player Andy is human, stopping bot declarations
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PHASE_TRACKING_FIX: Same phase update: declaration
âœ… PHASE_TRACKING_FIX: Marked declaration phase as triggered
ğŸ” DECL_PHASE_DEBUG: _handle_declaration_phase called with last_declarer: 'Bot 3'
ğŸ” BOT_DEBUG: Got declaration order from state machine: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ” DECL_PHASE_DEBUG: Declaration order: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ” DECL_PHASE_DEBUG: Last declarer 'Bot 3' index: 1
ğŸ” DECL_PHASE_DEBUG: Starting loop from index 2 to 4
ğŸ” DECL_PHASE_DEBUG: Checking player 2 (Bot 4), is_bot: True
ğŸ” DECL_PHASE_DEBUG: Player Bot 4 declared value: 0 (from phase data)
ğŸ” DECL_PHASE_DEBUG: All phase declarations: {'Bot 2': 1, 'Bot 3': 4}
ğŸ¤– DECL_PHASE_DEBUG: Bot Bot 4 will now declare!
ğŸ”§ BOT_DECLARE_DEBUG: State machine result: {'success': True, 'queued': True}
âœ… Bot Bot 4 declared 3
ğŸ” DECL_PHASE_DEBUG: Checking player 3 (Andy), is_bot: False
ğŸ” DECL_PHASE_DEBUG: Player Andy is human, stopping bot declarations
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PHASE_TRACKING_FIX: Same phase update: declaration
ğŸ‘¤ ENTERPRISE_BOT_DEBUG: Current declarer Andy is human - waiting
Wrong player turn: Bot 3, expected: Andy
Invalid action: GameAction(player_name='Bot 3', action_type=<ActionType.DECLARE: 'declare'>, payload={'value': 4}, timestamp=datetime.datetime(2025, 7, 4, 21, 54, 13, 198945), sequence_id=7, is_bot=True)
ğŸš« BOT_HANDLER_DEBUG: Handling action rejection
ğŸš« BOT_VALIDATION_FIX: Action declare from Bot 3 was REJECTED: Invalid action for current game state
ğŸš« BOT_VALIDATION_FIX: Bot Bot 3 action rejected - preventing downstream processing
ğŸš« BOT_VALIDATION_FIX: Bot Bot 3 hand size after rejection: 8
Wrong player turn: Bot 4, expected: Andy
Invalid action: GameAction(player_name='Bot 4', action_type=<ActionType.DECLARE: 'declare'>, payload={'value': 3}, timestamp=datetime.datetime(2025, 7, 4, 21, 54, 13, 451175), sequence_id=8, is_bot=True)
ğŸš« BOT_HANDLER_DEBUG: Handling action rejection
ğŸš« BOT_VALIDATION_FIX: Action declare from Bot 4 was REJECTED: Invalid action for current game state
ğŸš« BOT_VALIDATION_FIX: Bot Bot 4 action rejected - preventing downstream processing
ğŸš« BOT_VALIDATION_FIX: Bot Bot 4 hand size after rejection: 8
Wrong player turn: Bot 4, expected: Andy
Invalid action: GameAction(player_name='Bot 4', action_type=<ActionType.DECLARE: 'declare'>, payload={'value': 3}, timestamp=datetime.datetime(2025, 7, 4, 21, 54, 13, 704166), sequence_id=9, is_bot=True)
ğŸš« BOT_HANDLER_DEBUG: Handling action rejection
ğŸš« BOT_VALIDATION_FIX: Action declare from Bot 4 was REJECTED: Invalid action for current game state
ğŸš« BOT_VALIDATION_FIX: Bot Bot 4 action rejected - preventing downstream processing
ğŸš« BOT_VALIDATION_FIX: Bot Bot 4 hand size after rejection: 8
DEBUG_WS_RECEIVE: Received event 'declare' from client in room AC30F8 with data: {'value': 1, 'player_name': 'Andy'}
âœ… Declaration queued: Andy -> 1
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ¯ NEW_TURN_DEBUG: Round 1, Turn 1 starting with starter Bot 2
ğŸ¤– NEW_TURN_DEBUG: Notifying bot manager about new turn starter Bot 2 for room AC30F8
ğŸ” DUPLICATE_DEBUG: Received turn_started event for Bot 2 from unknown
ğŸ¤– Bot Bot 2 will play first
ğŸ¤– Bot Bot 2 thinking for 1.6s...
ğŸ¤– Bot Bot 2 choosing first play...
ğŸ¤– BOT chooses to play SINGLE (11 pts): ADVISOR
ğŸ¤– Bot Bot 2 will play 1 pieces: ['ADVISOR_BLACK(11)']
ğŸ¯ BOT_MANAGER_DEBUG: state_machine exists: True
ğŸ¯ BOT_PLAY_DEBUG: State machine result: {'success': True, 'queued': True}
ğŸ¯ BOT_PLAY_DEBUG: Action queued successfully, state machine will handle updates and broadcasting
âœ… Bot Bot 2 first play action queued - state machine will broadcast with correct next_player
ğŸ”¢ TURN_NUMBER_DEBUG: Backend game.turn_number = 1
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ”„ PHASE_TRACKING_FIX: New phase detected declaration -> turn
ğŸš€ ENTERPRISE_BOT_DEBUG: Turn phase - checking if Bot 2 is a bot
ğŸ¤– ENTERPRISE_BOT_DEBUG: Current player Bot 2 is a bot - checking for duplicates
âœ… REFINED_FIX: Allowing new trigger for current player Bot 2 from phase_change
âœ… RACE_CONDITION_FIX: New action recorded for Bot 2 - play_pieces from phase_change (hash: 36a22356f55e)
ğŸš« RACE_CONDITION_FIX: Skipping enterprise trigger for Bot 2 - turn starter already triggered by turn_started event
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” DUPLICATE_DEBUG: Received turn_started event for Bot 2 from unknown
ğŸš« TURN_START_FIX: Skipping duplicate turn_started event for Bot 2 turn 1
ğŸ¯ TURN_STATE_DEBUG: Processing action play_pieces from Bot 2
ğŸ¯ TURN_STATE_DEBUG: _handle_play_pieces called for Bot 2
ğŸ¯ TURN_STATE_DEBUG: Current state - player_index: 0, turn_order: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ¯ TURN_STATE_DEBUG: Player Bot 2 playing 1 pieces: ['ADVISOR_BLACK(11)']
ğŸ¯ TURN_STATE_DEBUG: Setting required piece count to 1
ğŸ¯ TURN_STATE_DEBUG: Before setting - required_piece_count was: None
ğŸ¯ TURN_STATE_DEBUG: After setting - required_piece_count is: 1
ğŸ¯ TURN_STATE_DEBUG: Before advancing - current_player_index: 0
ğŸ¯ TURN_STATE_DEBUG: After advancing - current_player_index: 1
ğŸ¯ TURN_STATE_DEBUG: Next player: Bot 3
ğŸ¯ TURN_STATE_DEBUG: Round 1, Turn 1 - Bot 2 played, next: Bot 3
ğŸ¯ UPDATE_DEBUG: About to update phase data with current_player: Bot 3, required_piece_count: 1
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PHASE_TRACKING_FIX: Same phase update: turn
ğŸš€ ENTERPRISE_BOT_DEBUG: Turn phase - checking if Bot 3 is a bot
ğŸ¤– ENTERPRISE_BOT_DEBUG: Current player Bot 3 is a bot - checking for duplicates
âœ… REFINED_FIX: Allowing new trigger for current player Bot 3 from phase_change
âœ… RACE_CONDITION_FIX: New action recorded for Bot 3 - play_pieces from phase_change (hash: ac20a113e367)
âœ… RACE_CONDITION_FIX: Triggering bot play for Bot 3 - no duplicates detected
ğŸ¯ BOT_PLAY_DEBUG: Got required_piece_count from state machine: 1
ğŸ¤– BOT chooses to play SINGLE (13 pts): GENERAL
ğŸ¯ BOT_PLAY_DEBUG: Final selection - 1 pieces: ['GENERAL_BLACK(13)']
ğŸ¯ BOT_PLAY_DEBUG: Action queued successfully, state machine will handle updates and broadcasting
âœ… Bot Bot 3 action queued - state machine will broadcast with correct next_player
ğŸ¯ UPDATE_DEBUG: Phase data updated - next_player should be: Bot 3
ğŸ¯ TURN_STATE_DEBUG: Play pieces result: {'status': 'play_accepted', 'player': 'Bot 2', 'pieces': [ADVISOR_BLACK(11)], 'piece_count': 1, 'required_count': 1, 'next_player': 'Bot 3', 'turn_complete': False}
âœ… BOT_VALIDATION_FIX: Bot Bot 2 play accepted - state machine handling all updates
ğŸ¯ TURN_STATE_DEBUG: Processing action play_pieces from Bot 3
ğŸ¯ TURN_STATE_DEBUG: _handle_play_pieces called for Bot 3
ğŸ¯ TURN_STATE_DEBUG: Current state - player_index: 1, turn_order: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ¯ TURN_STATE_DEBUG: Player Bot 3 playing 1 pieces: ['GENERAL_BLACK(13)']
ğŸ¯ TURN_STATE_DEBUG: Before advancing - current_player_index: 1
ğŸ¯ TURN_STATE_DEBUG: After advancing - current_player_index: 2
ğŸ¯ TURN_STATE_DEBUG: Next player: Bot 4
ğŸ¯ TURN_STATE_DEBUG: Round 1, Turn 1 - Bot 3 played, next: Bot 4
ğŸ¯ UPDATE_DEBUG: About to update phase data with current_player: Bot 4, required_piece_count: 1
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PHASE_TRACKING_FIX: Same phase update: turn
ğŸš€ ENTERPRISE_BOT_DEBUG: Turn phase - checking if Bot 4 is a bot
ğŸ¤– ENTERPRISE_BOT_DEBUG: Current player Bot 4 is a bot - checking for duplicates
âœ… REFINED_FIX: Allowing new trigger for current player Bot 4 from phase_change
âœ… RACE_CONDITION_FIX: New action recorded for Bot 4 - play_pieces from phase_change (hash: d2d760f0daf4)
âœ… RACE_CONDITION_FIX: Triggering bot play for Bot 4 - no duplicates detected
ğŸ¯ BOT_PLAY_DEBUG: Got required_piece_count from state machine: 1
ğŸ¤– BOT chooses to play SINGLE (14 pts): GENERAL
ğŸ¯ BOT_PLAY_DEBUG: Final selection - 1 pieces: ['GENERAL_RED(14)']
ğŸ¯ BOT_PLAY_DEBUG: Action queued successfully, state machine will handle updates and broadcasting
âœ… Bot Bot 4 action queued - state machine will broadcast with correct next_player
ğŸ¯ UPDATE_DEBUG: Phase data updated - next_player should be: Bot 4
ğŸ¯ TURN_STATE_DEBUG: Play pieces result: {'status': 'play_accepted', 'player': 'Bot 3', 'pieces': [GENERAL_BLACK(13)], 'piece_count': 1, 'required_count': 1, 'next_player': 'Bot 4', 'turn_complete': False}
âœ… BOT_VALIDATION_FIX: Bot Bot 3 play accepted - state machine handling all updates
DEBUG_WS_RECEIVE: Received event 'ping' from client in room lobby with data: {'timestamp': 1751691272703}
ğŸ¯ TURN_STATE_DEBUG: Processing action play_pieces from Bot 4
ğŸ¯ TURN_STATE_DEBUG: _handle_play_pieces called for Bot 4
ğŸ¯ TURN_STATE_DEBUG: Current state - player_index: 2, turn_order: ['Bot 2', 'Bot 3', 'Bot 4', 'Andy']
ğŸ¯ TURN_STATE_DEBUG: Player Bot 4 playing 1 pieces: ['GENERAL_RED(14)']
ğŸ¯ TURN_STATE_DEBUG: Before advancing - current_player_index: 2
ğŸ¯ TURN_STATE_DEBUG: After advancing - current_player_index: 3
ğŸ¯ TURN_STATE_DEBUG: Next player: Andy
ğŸ¯ TURN_STATE_DEBUG: Round 1, Turn 1 - Bot 4 played, next: Andy
ğŸ¯ UPDATE_DEBUG: About to update phase data with current_player: Andy, required_piece_count: 1
DEBUG_WS: Message for event 'phase_change' added to queue for room AC30F8.
ğŸ” PHASE_TRACKING_FIX: Same phase update: turn
ğŸš€ ENTERPRISE_BOT_DEBUG: Turn phase - checking if Andy is a bot
ğŸ‘¤ ENTERPRISE_BOT_DEBUG: Current player Andy is human - waiting
ğŸ¯ UPDATE_DEBUG: Phase data updated - next_player should be: Andy
ğŸ¯ TURN_STATE_DEBUG: Play pieces result: {'status': 'play_accepted', 'player': 'Bot 4', 'pieces': [GENERAL_RED(14)], 'piece_count': 1, 'required_count': 1, 'next_player': 'Andy', 'turn_complete': False}
âœ… BOT_VALIDATION_FIX: Bot Bot 4 play accepted - state machine handling all updates
DEBUG_WS_RECEIVE: Received event 'ping' from client in room AC30F8 with data: {'timestamp': 1751691274956}
